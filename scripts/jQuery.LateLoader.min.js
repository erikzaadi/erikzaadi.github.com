/*
* jQuery Late Loader
*
* Copyright (c) 2009 Erik Zaadi
*
* Plugin home page : http://plugins.jquery.com/project/TODO! 
* Wiki : http://wiki.github.com/erikzaadi/jQueryPlugins/jquerylateloader
* 
* Dual licensed under the MIT and GPL licenses:
*   http://www.opensource.org/licenses/mit-license.php
*   http://www.gnu.org/licenses/gpl.html
*/
;(function($){$.LateLoader={LoadScriptOrCSS:_LoadScriptOrCSS,IsScriptOrCSSLoaded:_IsScriptOrCSSLoaded,GetLoadedScriptOrCSSs:_GetScriptOrCSSArray,GetLoadedScriptOrCSSsByType:_GetScriptOrCSSArrayByType,PluginDefaults:{ArrayDataKey:"LateLoaderDataKey",ElementToAttachDataTo:"body",RemoteTimeout:1500},Defaults:{URL:null,Type:"js",LoadedCallBackFunction:null,ErrorCallBackFunction:null}};
function _LoadScriptOrCSS(OptionsOrURL){var options;if(typeof(OptionsOrURL)=="string"){options=$.extend({},$.LateLoader.Defaults,{URL:OptionsOrURL});
}else{options=$.extend({},$.LateLoader.Defaults,OptionsOrURL);}if(_IsScriptOrCSSLoaded(options.URL,options.Type)){_CallFunctionIfAvailable(options.LoadedCallBackFunction,options.URL);
return;}if(options.Type=="js"){if(_URLIsRemote(options.URL)){setTimeout(function(){if(!_IsScriptOrCSSLoaded(options.URL,options.Type)){_Error(options);
}},$.LateLoader.PluginDefaults.RemoteTimeout);}$.ajax({dataType:"script",url:options.URL,success:function(){_Success(options);
},error:function(){_Error(options);},data:{}});}else{_AddCSSFile(options);}}function _IsScriptOrCSSLoaded(URL,Type){var ScriptOrCSSArray=_GetScriptOrCSSArray()||{};
return(ScriptOrCSSArray[Type]&&($.inArray(URL,ScriptOrCSSArray[Type])!=-1))?true:false;
}function _GetScriptOrCSSArray(){var ScriptOrCSSData=$($.LateLoader.PluginDefaults.ElementToAttachDataTo).data($.LateLoader.PluginDefaults.ArrayDataKey);
var ScriptOrCSSArray=ScriptOrCSSData&&ScriptOrCSSData.ScriptOrCSSs?ScriptOrCSSData.ScriptOrCSSs:false;
if(!ScriptOrCSSArray){return false;}else{return ScriptOrCSSArray;}}function _GetScriptOrCSSArrayByType(Type){var ScriptOrCSSArray=_GetScriptOrCSSArray()||false;
if(!ScriptOrCSSArray){return false;}if(!ScriptOrCSSArray[Type]){return false;}return ScriptOrCSSArray[Type];
}function _Error(options){_CallFunctionIfAvailable(options.ErrorCallBackFunction,"error loading "+options.Type+" - "+options.URL);
}function _Success(options){_AddLoadedScriptOrCSSToArray(options);_CallFunctionIfAvailable(options.LoadedCallBackFunction,options.URL);
}function _ValidateCSSFileLoaded(options){var $createdLink=$("link[href='"+options.URL+"']");
var success=true;if(!$createdLink.length){success=false;}if($createdLink.get(0).readyState){var created=$createdLink.get(0).readyState;
success=created=="complete"||created=="loaded";}else{if(false){success=false;}}if(success){_Success(options);
}else{_Error(options);}}function _AddCSSFile(options){if(!_URLIsRemote(options.URL)){$.ajax({url:options.URL,dataType:"text",success:function(data){var randID=Math.round(Math.random()*321312);
var $link=$("<style />").attr({rel:"stylesheet",type:"text/css",id:randID.toString()});
$link.appendTo("head");setTimeout(function(){var created=$("#"+randID.toString());
if($.browser.msie){created.get(0).styleSheet.cssText=data;}else{created.text(data);
}_Success(options);},15);},error:function(){_Error(options);},data:{}});}else{$("<link />").ready(function(){setTimeout(function(){_ValidateCSSFileLoaded(options);
},15);}).attr({rel:"stylesheet",type:"text/css",href:options.URL}).appendTo("head");
}}function _AddLoadedScriptOrCSSToArray(options){var ScriptOrCSSArray=_GetScriptOrCSSArray()||{};
if(!ScriptOrCSSArray[options.Type]){ScriptOrCSSArray[options.Type]=new Array();}ScriptOrCSSArray[options.Type].push(options.URL);
$($.LateLoader.PluginDefaults.ElementToAttachDataTo).data($.LateLoader.PluginDefaults.ArrayDataKey,{ScriptOrCSSs:ScriptOrCSSArray});
}function _CallFunctionIfAvailable(method,param){if(method&&$.isFunction(method)){method(param);
}}function _URLIsRemote(url){return url.indexOf("http")>-1&&(url.indexOf("http://"+window.location.host)==-1&&url.indexOf("https://"+window.location.host)==-1);
}})(jQuery);